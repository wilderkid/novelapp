 # StoryForge (故事熔炉) 启动指南

## 系统要求

- Windows 操作系统
- Python 3.8 或更高版本
- Node.js 14.0 或更高版本
- PostgreSQL 数据库

## 安装步骤

### 1. 克隆项目

如果您是从GitHub或其他地方下载的源代码，请确保已获取完整的项目文件。

### 2. 安装依赖

#### 使用Windows批处理文件（推荐）

在项目根目录下，双击运行 `install.bat` 文件，或在命令提示符中执行：

```bash
install.bat
```

#### 使用PowerShell（高级用户）

在项目根目录下，右键点击PowerShell窗口并选择"以管理员身份运行"，然后执行：

```powershell
.\install.ps1
```

如果遇到执行策略问题，请先执行：
```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

### 3. 配置数据库

1. 确保已安装并运行PostgreSQL数据库
2. 使用pgAdmin或psql创建名为`storyforge`的数据库
3. 执行`database/init.sql`文件初始化数据库表和示例数据

### 4. 配置环境变量

编辑`backend/.env`文件，确保以下配置正确：

```env
# 数据库配置
DATABASE_URL=postgresql://postgres:您的密码@localhost/storyforge

# AI API配置
AI_API_URL=https://api.chatanywhere.tech/v1
AI_API_KEY=您的API密钥
AI_MODEL=gpt-3.5-turbo
AI_TEMPERATURE=0.7
AI_MAX_TOKENS=4096

# 应用配置
DEBUG=True
HOST=0.0.0.0
PORT=9009
```

## 启动应用

### 方法一：使用脚本启动（推荐）

#### 使用Windows批处理文件

在项目根目录下，双击运行 `start.bat` 文件，或在命令提示符中执行：

```bash
start.bat
```

#### 使用PowerShell

在项目根目录下，右键点击PowerShell窗口并选择"以管理员身份运行"，然后执行：

```powershell
.\start.ps1
```

### 方法二：手动启动

1. 启动后端服务
   ```bash
   cd backend
   python main.py
   ```

2. 启动前端应用（新开一个命令行窗口）
   ```bash
   cd frontend
   npm run dev
   ```

## 访问应用

启动成功后，您可以通过以下地址访问应用：

- 前端应用地址: http://localhost:5173
- 后端API地址: http://localhost:9009
- API文档地址: http://localhost:9009/docs

## 常见问题

### 端口被占用

如果9009端口已被占用，可以修改`backend/.env`文件中的`PORT`值为其他可用端口。

### 数据库连接失败

1. 确保PostgreSQL服务正在运行
2. 检查`backend/.env`文件中的数据库连接信息是否正确
3. 确保已创建名为`storyforge`的数据库并执行了初始化脚本

### 前端依赖安装失败

请确保已安装最新版本的Node.js和npm，或者尝试清除npm缓存：

```bash
npm cache clean --force
```

## 开发模式

在开发模式下，后端会启用调试功能，前端会启用热重载功能。如果需要部署到生产环境，请参考部署文档。

## 技术栈

- 后端：FastAPI + SQLAlchemy + PostgreSQL
- 前端：Vue.js + Element Plus + Electron
- 编辑器：UEditorPlus
