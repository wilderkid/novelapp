# 局域网访问配置指南

## 1. 后端配置

后端已经配置为监听所有网络接口（`0.0.0.0`），无需修改。

在 `backend/main.py` 第1455行：
```python
uvicorn.run(app, host="0.0.0.0", port=9009)
```

## 2. 前端配置

### 方法一：使用 Vite 的 --host 参数（推荐）

修改 `frontend/package.json` 中的 dev 脚本：

```json
{
  "scripts": {
    "dev": "vite --host"
  }
}
```

### 方法二：修改 vite.config.js

在 `frontend/vite.config.js` 中添加 server 配置：

```javascript
export default defineConfig({
  plugins: [vue()],
  server: {
    host: '0.0.0.0',  // 监听所有网络接口
    port: 5173
  }
})
```

## 3. 前端API地址配置

修改 `frontend/src/config.js`，将后端API地址改为服务器的局域网IP：

```javascript
// 将 localhost 改为服务器的局域网IP地址
export const API_BASE_URL = 'http://192.168.1.100:9009'  // 替换为你的实际IP
```

或者使用环境变量：

```javascript
export const API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:9009'
```

然后创建 `frontend/.env.local` 文件：
```
VITE_API_URL=http://192.168.1.100:9009
```

## 4. 后端CORS配置

确保后端允许局域网访问。在 `backend/main.py` 中修改CORS配置：

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:5173",
        "http://192.168.1.100:5173",  # 添加服务器局域网IP
        "http://192.168.1.*:5173"     # 或使用通配符（不推荐生产环境）
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

更安全的做法是允许所有局域网地址：
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 开发环境可以使用，生产环境应该指定具体域名
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

## 5. 获取服务器IP地址

### Windows:
```cmd
ipconfig
```
查找 "IPv4 地址"

### Linux/Mac:
```bash
ifconfig
# 或
ip addr show
```

## 6. 防火墙配置

### Windows防火墙：
1. 打开 Windows Defender 防火墙
2. 点击"高级设置"
3. 添加入站规则，允许端口 5173 和 9009

### Linux防火墙（ufw）：
```bash
sudo ufw allow 5173
sudo ufw allow 9009
```

## 7. 启动应用

### 后端：
```bash
cd backend
python main.py
```

### 前端：
```bash
cd frontend
npm run dev
```

## 8. 访问应用

在局域网内的其他设备上，使用浏览器访问：
```
http://192.168.1.100:5173
```
（将 192.168.1.100 替换为你的服务器实际IP地址）

## 注意事项

1. **安全性**：局域网访问时，确保网络环境安全
2. **数据库**：确保数据库也允许局域网连接（如果数据库在其他机器上）
3. **性能**：局域网访问速度取决于网络质量
4. **端口占用**：确保 5173 和 9009 端口没有被其他程序占用